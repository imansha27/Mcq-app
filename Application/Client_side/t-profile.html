<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles/t-profile.css" />
  <link rel="stylesheet" href="styles/navbar.css" />
  <title>Profile</title>
</head>
<body>
  <div class="navbar-container" id="navbarContainer"></div>
  <div class="tpro">
    <div class="rec">
      <h1>Questions:</h1>
      <div class="rec0">
        <h3>Submitted Questions</h3>
        <p>You can check all your submited questions here.These questions should be approved by the administrators to be added to the question bank</p>
      <button class="btnq" onclick="location.href='submitQ.html'">View</button>
      
      </div>

      <div class="rec1">
        <h3>Approved Questions</h3>
        <p>You can check all your approved questions here.All the questions here are already approved by the administrators and added to the question bank</p>
        <button class="btnq" onclick="location.href='approveQ.html'">View</button>
      </div>
    </div>
    

    <div class="rec2">
      <div class="profile-icon" id="profileIconContainer">
        <!-- Profile Image will be loaded here -->
        <img id="profile-image" src="#" />
      </div>

      <input
        type="file"
        id="profile-image-input"
        style="display: none"
        accept="image/*"
      />
      <button id="upload-button">+</button>

      <h1 id="username"></h1>
      <div class="tpro1">
        <h3>Name: <span id="name-value"></span></h3>
       
        
        <h3>Email: <span id="email-value"></span></h3>
        <input type="email" id="email-input" style="display: none" />
        
        <h3>User Type: <span id="usertype"></span></h3>

        <div id="teaches-at-section">
          <h3>Teaches at: <span id="teaches-at-value"></span></h3>
          <input type="text" id="teaches-at-input" style="display: none" />
        </div>
        
        <button id="edit-save-button" >Edit</button>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>



    // Fetch and inject navbar contents
    fetch("./components/Teacher_navbar.html")
      .then((response) => response.text())
      .then((html) => {
        document.getElementById("navbarContainer").innerHTML = html;
      })
      .catch((error) =>
        console.error("Error fetching navbar content:", error)
      );

      function toggleUploadButtonVisibility(show) {
      const uploadButton = document.getElementById("upload-button");
      uploadButton.style.display = show ? "block" : "none";
    }



    // Handle profile image input
    document.getElementById("upload-button").addEventListener("click", function () {
      document.getElementById("profile-image-input").click(); 
    });





    // Edit/Save button click event
     document.getElementById("edit-save-button").addEventListener("click", function () {
      const isEditMode = this.innerText === "Edit";
      toggleEditInputs(isEditMode); // Toggle edit inputs
      toggleUploadButtonVisibility(isEditMode); 
      console.log("Clicked Save Button");// Toggle upload button visibility
      if (!isEditMode) saveChanges(); 
    });

    // Function to toggle between edit and view mode for all inputs
    function toggleEditInputs(editMode) {
      const elements = [ "email", "teaches-at"];
      elements.forEach((elementId) => {
        const viewElement = document.getElementById(`${elementId}-value`);
        const editElement = document.getElementById(`${elementId}-input`);
        if (editMode) {
          viewElement.style.display = "none";
          editElement.style.display = "inline-block";
        } else {
          viewElement.style.display = "inline-block";
          editElement.style.display = "none";
        }
      });
    
      document.getElementById("edit-save-button").innerText = editMode ? "Save" : "Edit";
    }




 
  // Function to save changes to Email, and Teaches At and image fields
  function saveChanges() {
    console.log("Saving Changes...");
    const newEmail = document.getElementById("email-input").value;
    const newTeachesAt = document.getElementById("teaches-at-input").value;

    const token = localStorage.getItem("token");
    const imageData = document.getElementById("profile-image").src; // Get the image data
    axios.post("http://localhost:8000/edit-profile", {
      Email: newEmail,
      School: newTeachesAt,
      image: imageData, // Send the image data to the server
    }, {
      headers: {
        Authorization: `Bearer ${token}`,
      },
    })
      .then((response) => {
        const data = response.data;
        console.log("Profile data saved successfully:", data);
      })
      .catch((error) => console.error("Error saving profile data:", error));
  }

  // Fetch user details
  const token = localStorage.getItem("token");
  console.log(token);
  axios.get("http://localhost:8000/profile", {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  })
    .then((response) => {
      console.log(response.data.data);
      const data = response.data.data;
      document.getElementById("profile-image").src = data.image;
      document.getElementById("username").innerText = data.UserName;
      document.getElementById("name-value").innerText = data.FirstName + " " + data.LastName;
      document.getElementById("email-value").innerText = data.Email;
      document.getElementById("usertype").innerText = data.UserType;
      const teachesAtValue = document.getElementById("teaches-at-value");
      if (data.TeachesAt) {
        teachesAtValue.innerText = data.TeachesAt;
      } else {
        teachesAtValue.innerText = "(Not set)";
      }
    })
    .catch((error) => console.error("Error fetching user details:", error));
</script>
</body>
</html>


